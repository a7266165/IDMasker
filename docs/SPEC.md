# IDMasker - 資料夾去識別化工具 需求規格書

## 1. 概述

將含有可識別編號的資料夾名稱，透過 AES 加密轉換為去識別化名稱。
資料夾內容完全不做改動，僅重新命名資料夾。
使用者可透過密碼進行還原（解密）。

## 2. 資料夾名稱結構

### 2.1 原始格式
```
XXXXXXXX_YYYYMMDDHHMI
```
- `XXXXXXXX`: 8 碼純數字編號（**需加密的目標**）
- `_`: 底線分隔符
- `YYYYMMDDHHMI`: 12 碼日期時間（年月日時分，**保留不動**）

### 2.2 去識別化後格式
```
YYYYMMDDHHMI_<加密後字串>
```
- 日期時間移至前方
- 加密後字串接在底線後方

### 2.3 範例
```
加密前: 12345678_202602060821
加密後: 202602060821_a3f2b8c1d4e5f6a7b8c9d0e1f2a3b4c5

還原:   202602060821_a3f2b8c1d4e5f6a7b8c9d0e1f2a3b4c5
還原後: 12345678_202602060821
```

## 3. 操作流程

### 3.1 加密（去識別化）
```
1. 使用者透過 GUI 選擇父資料夾
2. 軟體自動掃描所有符合 8碼_12碼 格式的子資料夾
3. 使用者輸入密碼（需輸入兩次確認）
4. 軟體對每個資料夾的 8 碼編號進行 AES 加密
5. 資料夾重新命名為: YYYYMMDDHHMI_<加密結果>
6. 資料夾內容不做任何改動
```

### 3.2 解密（還原）
```
1. 使用者透過 GUI 選擇父資料夾
2. 軟體自動掃描所有符合 12碼_加密字串 格式的子資料夾
3. 使用者輸入密碼（需輸入兩次確認）
4. 軟體對加密字串進行 AES 解密，還原出原始 8 碼編號
5. 資料夾重新命名為: XXXXXXXX_YYYYMMDDHHMI
```

## 4. 加密方案

### 4.1 演算法
- **暫定: AES-256 完整輸出**（待與最終使用者確認）
- 備選: FPE（格式保留加密），輸出為 8 碼純數字

### 4.2 Key 衍生
- 使用 PBKDF2-HMAC-SHA256 從使用者密碼衍生 256-bit AES key
- Salt: 固定值或可配置（確保同密碼 + 同輸入 = 同輸出）

### 4.3 加密模式
- AES-ECB（單一 block，確定性輸出）
- 輸入: 8 碼數字（padding 至 16 bytes）
- 輸出: 16 bytes = 32 hex 字元

### 4.4 安全特性
- 無密碼無法逆推原始編號
- 同一密碼 + 同一編號 → 永遠產生相同加密結果（確定性）
- 碰撞機率: 零（AES 為一對一映射，完整輸出不截斷）

## 5. GUI 介面設計

### 5.1 技術
- Python tkinter（內建，無需額外安裝）

### 5.2 介面元素
```
┌─────────────────────────────────────┐
│         IDMasker 去識別化工具         │
├─────────────────────────────────────┤
│                                     │
│  模式: ○ 加密（去識別化）  ○ 解密（還原） │
│                                     │
│  目標資料夾: [_______________] [瀏覽] │
│                                     │
│  密碼:       [_______________]       │
│  確認密碼:   [_______________]       │
│                                     │
│  [掃描資料夾]                        │
│                                     │
│  ┌─ 掃描結果 ─────────────────────┐ │
│  │ ☑ 12345678_202602060821       │ │
│  │ ☑ 87654321_202601150930       │ │
│  │ ☐ not_a_match（不符格式，略過） │ │
│  └───────────────────────────────┘ │
│                                     │
│  [執行轉換]                          │
│                                     │
│  狀態: 就緒                          │
└─────────────────────────────────────┘
```

### 5.3 功能需求
- 選擇父資料夾（瀏覽按鈕）
- 密碼輸入 + 重複確認（兩次不一致時提示錯誤）
- 掃描並列出符合格式的資料夾
- 勾選要處理的資料夾
- 執行加密/解密
- 顯示處理進度與結果

## 6. 技術規格

### 6.1 開發語言
- Python 3.10+

### 6.2 核心依賴
- `pycryptodome`: AES 加密/解密
- `tkinter`: GUI（Python 內建）
- `PyInstaller`: 打包為 exe

### 6.3 交付形式
- 單一 exe 執行檔，Windows 環境直接執行

### 6.4 專案結構
```
IDMasker/
├── docs/
│   ├── SPEC.md              # 本文件 - 需求規格書
│   └── OPEN_QUESTIONS.md    # 待確認事項
├── src/
│   ├── __init__.py
│   ├── main.py              # 程式進入點
│   ├── crypto.py            # 加密/解密核心邏輯
│   ├── folder_scanner.py    # 資料夾掃描與重新命名
│   └── gui.py               # tkinter GUI
├── tests/
│   ├── test_crypto.py       # 加密解密測試
│   └── test_scanner.py      # 掃描邏輯測試
├── pyproject.toml
└── requirements.txt
```
